#!/usr/bin/env bash
#MISE description="Remove a specific link from all registered repositories"
#MISE dir="{{cwd}}"
#USAGE arg "<name>" help="Link name: pull_request_template, pre-commit-config, markdownlint, mcp"

LINK_NAME="${usage_name}"
REGISTRY_DIR="${HOME}/.config/mise/linked-repos"

REGISTRY_FILE="$REGISTRY_DIR/${LINK_NAME}.txt"
if [ ! -f "$REGISTRY_FILE" ]; then
  echo "Unknown link: $LINK_NAME"
  echo "Available: pull_request_template, pre-commit-config, markdownlint, mcp"
  exit 1
fi

case "$LINK_NAME" in
  pull_request_template) TARGET=".github/workflows/pull_request_template.md" ;;
  pre-commit-config) TARGET=".pre-commit-config.yaml" ;;
  markdownlint) TARGET=".markdownlint-cli2.jsonc" ;;
  mcp) TARGET=".mcp.json" ;;
esac

while IFS= read -r repo; do
  if [ -L "$repo/$TARGET" ]; then
    unlink "$repo/$TARGET"
    echo "Removed: $repo/$TARGET"
  fi
done < "$REGISTRY_FILE"

rm "$REGISTRY_FILE"
echo "Registry cleaned: $LINK_NAME"
