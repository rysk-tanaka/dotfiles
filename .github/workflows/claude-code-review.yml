name: Claude Code Review

on:
  # 1. PRã‚¿ã‚¤ãƒˆãƒ«ã«[review]ãŒå«ã¾ã‚Œã‚‹å ´åˆ
  pull_request:
    types: [opened, synchronize]

  # 2. PRã‚³ãƒ¡ãƒ³ãƒˆã§@claude-reviewã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³
  issue_comment:
    types: [created]

  # 3. æ‰‹å‹•å®Ÿè¡Œ
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PRç•ªå·ã‚’æŒ‡å®šã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè¡Œ"
        required: true
        type: string

jobs:
  claude-review:
    if: |
      (github.event_name == 'pull_request' && contains(github.event.pull_request.title, '[review]')) ||
      (github.event_name == 'issue_comment' && github.event.issue.pull_request && contains(github.event.comment.body, '@claude-review')) ||
      (github.event_name == 'workflow_dispatch')

    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

          # Optional: Specify model (defaults to Claude Sonnet 4, uncomment for Claude Opus 4)
          # model: "claude-opus-4-20250514"

          # Direct prompt for automated review (no @claude mention needed)
          direct_prompt: |
            ã“ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ—¥æœ¬èªã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¦ãã ã•ã„ï¼š
            - ã‚³ãƒ¼ãƒ‰å“è³ªã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
            - æ½œåœ¨çš„ãªãƒã‚°ã‚„å•é¡Œ
            - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®äº‹é …
            - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µ

            å›ç­”ã¯ç°¡æ½”ã«ã¾ã¨ã‚ã€ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

            ## âœ… è‰¯ã„ç‚¹
            - ï¼ˆä¸»è¦ãªè‰¯ã„ç‚¹ã‚’2-3å€‹ï¼‰

            ## âš ï¸ æ”¹å–„ç‚¹
            - ï¼ˆé‡è¦ãªå•é¡Œã®ã¿1-3å€‹ï¼‰

            ## ç·åˆè©•ä¾¡
            æ‰¿èª / è¦ä¿®æ­£ / ã‚³ãƒ¡ãƒ³ãƒˆ

            ---
            ğŸ’° ã‚³ã‚¹ãƒˆ: å…¥åŠ›XXXãƒˆãƒ¼ã‚¯ãƒ³, å‡ºåŠ›XXXãƒˆãƒ¼ã‚¯ãƒ³, $X.XX

          # Optional: Customize review based on file types
          # direct_prompt: |
          #   Review this PR focusing on:
          #   - For TypeScript files: Type safety and proper interface usage
          #   - For API endpoints: Security, input validation, and error handling
          #   - For React components: Performance, accessibility, and best practices
          #   - For tests: Coverage, edge cases, and test quality

          # Optional: Different prompts for different authors
          # direct_prompt: |
          #   ${{ github.event.pull_request.author_association == 'FIRST_TIME_CONTRIBUTOR' &&
          #   'Welcome! Please review this PR from a first-time contributor. Be encouraging and provide detailed explanations for any suggestions.' ||
          #   'Please provide a thorough code review focusing on our coding standards and best practices.' }}

          # Optional: Add specific tools for running tests or linting
          # allowed_tools: "Bash(npm run test),Bash(npm run lint),Bash(npm run typecheck)"

          # Optional: Skip review for certain conditions
          # if: |
          #   !contains(github.event.pull_request.title, '[skip-review]') &&
          #   !contains(github.event.pull_request.title, '[WIP]')
