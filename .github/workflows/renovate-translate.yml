name: Renovate Release Notes Translation

on:
  pull_request:
    types: [opened, edited]

  workflow_dispatch:
    inputs:
      pr_number:
        description: "PRç•ªå·ã‚’æŒ‡å®šã—ã¦ç¿»è¨³ã‚’å®Ÿè¡Œ"
        required: true
        type: string

jobs:
  translate:
    if: |
      (github.event_name == 'pull_request' && github.actor == 'renovate[bot]') ||
      (github.event_name == 'workflow_dispatch')

    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 1

      - name: Translate Release Notes
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

          prompt: |
            Renovate ãŒä½œæˆã—ãŸ PR ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’æ—¥æœ¬èªã§è¦ç´„ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚

            ## æ‰‹é †

            1. ä¸‹è¨˜ã€Œå¯¾è±¡PRã€ã«è¨˜è¼‰ã® PRç•ªå·ã‚’ä½¿ã„ `gh pr view <PRç•ªå·>` ã§ PR æœ¬æ–‡ã‚’å–å¾—ã™ã‚‹
            2. PR æœ¬æ–‡ã‹ã‚‰ Release Notes ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ`### Release Notes` ä»¥é™ï¼‰ã‚’æŠ½å‡ºã™ã‚‹
            3. å†…å®¹ãŒå®Ÿè³ªçš„ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
               - Compare Source ãƒªãƒ³ã‚¯ã®ã¿ã€changelog ã®ãƒªãƒ³ã‚¯ã®ã¿ã€ã¾ãŸã¯ç©ºã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
               - ã‚¹ã‚­ãƒƒãƒ—æ™‚ã¯ã€Œãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«å®Ÿè³ªçš„ãªå†…å®¹ãŒãªã„ãŸã‚ã€ç¿»è¨³ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸã€‚ã€ã¨ã ã‘ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
            4. å®Ÿè³ªçš„ãªå†…å®¹ãŒã‚ã‚‹å ´åˆã€ä»¥ä¸‹ã®å½¢å¼ã§æ—¥æœ¬èªã®è¦ç´„ã‚’ä½œæˆã™ã‚‹
               - å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«ä¸»è¦ãªå¤‰æ›´ç‚¹ã‚’ç®‡æ¡æ›¸ãã§ã¾ã¨ã‚ã‚‹
               - æŠ€è¡“çš„ãªç”¨èªã¯ãã®ã¾ã¾æ®‹ã—ã¦ã‚ˆã„
               - ç°¡æ½”ã•ã‚’é‡è¦–ã™ã‚‹

            ## ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†

            - ã‚³ãƒ¡ãƒ³ãƒˆã®å…ˆé ­ã« `<!-- renovate-translate -->` ãƒãƒ¼ã‚«ãƒ¼ã‚’å«ã‚ã‚‹ï¼ˆHTML ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ä¸å¯è¦–ï¼‰
            - æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ä»˜ãã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ã™ã‚‹
              - `gh api repos/${{ github.repository }}/issues/${{ github.event.pull_request.number || github.event.inputs.pr_number }}/comments` ã§ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—
              - body ã« `<!-- renovate-translate -->` ã‚’å«ã‚€ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¢ã™
              - è¦‹ã¤ã‹ã£ãŸå ´åˆ: `gh api -X PATCH repos/${{ github.repository }}/issues/comments/COMMENT_ID -f body="..."` ã§æ›´æ–°
              - è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ: `gh pr comment` ã§æ–°è¦æŠ•ç¨¿

            ## ã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼

            ```text
            <!-- renovate-translate -->
            ## ğŸ“‹ ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆè¦ç´„

            ï¼ˆæ—¥æœ¬èªã®è¦ç´„å†…å®¹ï¼‰

            ---
            ğŸ¤– ãƒ¢ãƒ‡ãƒ«: [å®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«å] / ğŸ’° ã‚³ã‚¹ãƒˆ: å…¥åŠ›[N]ãƒˆãƒ¼ã‚¯ãƒ³, å‡ºåŠ›[M]ãƒˆãƒ¼ã‚¯ãƒ³, $[é‡‘é¡]
            ```

            ## å¯¾è±¡PR

            PRç•ªå·: ${{ github.event.pull_request.number || github.event.inputs.pr_number }}

          allowed_bots: "renovate[bot]"
          claude_args: '--model claude-sonnet-4-6 --allowed-tools "Bash(gh pr view:*),Bash(gh pr comment:*),Bash(gh api:*)"'
